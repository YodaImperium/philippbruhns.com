<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #649b41;
        }
    </style>

    
    
    
    
    
    

    
    <title>yodaimperium.de</title>
    <meta name="description" content="A static website made with Hugo and GitHub Actions deployment">
    <meta name="keywords" content='blog, gokarna, hugo, English, Projects'>

    <meta property="og:url" content="https://yodaimperium.de/projects/website/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="yodaimperium.de">
    <meta property="og:description" content="A static website made with Hugo and GitHub Actions deployment">
    <meta property="og:image" content="https://yodaimperium.de/images/pickle.png">
    <meta property="og:image:secure_url" content="https://yodaimperium.de/images/pickle.png">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="yodaimperium.de">
    <meta name="twitter:description" content="A static website made with Hugo and GitHub Actions deployment">
    <meta property="twitter:domain" content="https://yodaimperium.de/projects/website/">
    <meta property="twitter:url" content="https://yodaimperium.de/projects/website/">
    <meta name="twitter:image" content="https://yodaimperium.de/images/pickle.png">

    
    <link rel="canonical" href="https://yodaimperium.de/projects/website/" />

    <link rel="stylesheet" type="text/css" href="https://yodaimperium.de/css/normalize.min.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" type="text/css" href="https://yodaimperium.de/css/main.css">
    <link disabled id="dark-theme" rel="stylesheet" href="https://yodaimperium.de/css/dark.css">

    <script src="https://yodaimperium.de/js/svg-injector.min.js"></script>
    <script src="https://yodaimperium.de/js/feather-icons.min.js"></script>
    <script src="https://yodaimperium.de/js/main.js"></script>

    
    
</head>
<body>
        <script type="text/javascript">
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">

        
        <div class="avatar">
            <a href="https://yodaimperium.de">
                <img src="https://yodaimperium.de/images/pickle.png" alt="avatar" />
            </a>
        </div>
        

        <div class="nav-title">
            <a class="nav-brand" href="https://yodaimperium.de">Philipp Bruhns</a>
        </div>

        <div class="nav-links">
            
            <div class="nav-link">
                <a href="https://yodaimperium.de/"><span data-feather='home'></span> Home </a>
            </div>
            
            <div class="nav-link">
                <a href="https://yodaimperium.de/posts/"><span data-feather='book'></span> Posts </a>
            </div>
            
            <div class="nav-link">
                <a href="https://yodaimperium.de/projects/"><span data-feather='code'></span> Projects </a>
            </div>
            
            <div class="nav-link">
                <a href="https://github.com/YodaImperium/website-deployment/"><span data-feather='github'></span>  </a>
            </div>
            
            <div class="nav-link">
                <a href="https://yodaimperium.de/index.xml"><span data-feather='rss'></span>  </a>
            </div>
            

            <span class="nav-icons-divider"></span>
            <div class="nav-link dark-theme-toggle">
                <span id="dark-theme-toggle-screen-reader-target" class="sr-only"></span>
                <a>
                    <span id="theme-toggle-icon" data-feather="moon"></span>
                </a>
            </div>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span id="hamburger-menu-toggle-screen-reader-target" class="sr-only">menu</span>
                <a>
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">
                
                <li class="nav-item">
                    <a href="https://yodaimperium.de/"><span data-feather='home'></span> Home </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://yodaimperium.de/posts/"><span data-feather='book'></span> Posts </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://yodaimperium.de/projects/"><span data-feather='code'></span> Projects </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://github.com/YodaImperium/website-deployment/"><span data-feather='github'></span>  </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://yodaimperium.de/index.xml"><span data-feather='rss'></span>  </a>
                </li>
                
                <li class="nav-item dark-theme-toggle">
                    <span id="dark-theme-toggle-screen-reader-target" class="sr-only">theme</span>
                    <a>
                        <span id="theme-toggle-icon" data-feather="moon"></span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>yodaimperium.de</h1>
        <small role="doc-subtitle">A static website made with Hugo and GitHub Actions deployment</small>
        <p class="post-date">
            May 12, 2023
        </p>

        <ul class="post-tags">
        
            <li class="post-tag"><a href="https://yodaimperium.de/tags/english">English</a></li>
        
            <li class="post-tag"><a href="https://yodaimperium.de/tags/projects">Projects</a></li>
        
        </ul>
    </div>

    <div class="post-content">
        <p>
            <p>In this article I&rsquo;m going to explain the underlying architecture of this website. I think I&rsquo;ve found a very cool way to deploy just by pushing to the <a href="https://github.com/YodaImperium/website-deployment/">GitHub Repository</a> <strong>without</strong> exposing any SSH keys, etc.. However, I took a lot of inspiration from this guy called <a href="https://www.youtube.com/watch?v=ATenAnk8eX4"><em>Wolfgang&rsquo;s Channel</em></a> on YouTube.</p>
<p><em>TL;DR</em><br>
It is created with Hugo and deployed via GitHub Actions to a RaspberryPi running nginx.</p>
<h1 id="static-website-generation">Static Website Generation</h1>
<p>This very website is created with Hugo and the Gokarna Theme. I chose Hugo because it is very easy in my opinion but offers a wide range of quite powerful themes. Because I really just want to show some posts like this and general information about me, a static site is just fine for me.</p>
<h2 id="what-is-hugo">What is Hugo?</h2>
<p>Hugo is a static website generator written in GoLang which generates you an entire (static) website just from markdown files. This way writing article likes this can be done in markdown which makes it <strong>a lot</strong> easier than coding every page manually in HTML.</p>
<h2 id="my-configuration">My configuration</h2>
<p>I pretty much just used Hugo out of the box. However, I did use the Gokarna Theme. It can be found in the footer.</p>
<h1 id="hosting">Hosting</h1>
<p>This entire website is hosted on a Raspberry Pi 3. That runs on Raspberry Pi OS Lite. I chose this over a &ldquo;real server&rdquo; or a VPS because I had this Raspberry Pi lying around and though It&rsquo;d be cheaper while still being easy to maintain.</p>
<h2 id="software">Software</h2>
<p>I pretty much just use nginx as the underlying webserver.</p>
<h2 id="security">Security</h2>
<p>In order ensure the website can be accessed securely all traffic is SSL encrypted using certbot for SSL-certificate generation.</p>
<p>Because the SSH port also has to be opened to the internet in order for my GitHub Actions script to work properly, I had to secure the Pi against unauthorized acces via SSH too.</p>
<p>Therefore, I made sure the GitHub Actions script only accesses the server as a deploy user. The deploy users home directory also is the nginx hosting directory.
Additionally, only passwordless SSH login using SSH-keys is allowed on the server. Login as root is also not allowed. I edited the sshd configuration file like this:</p>
<pre><code>PasswordAuthentication no
PermitRootLogin no
#PermitRootLogin prohibit-password
</code></pre>
<h1 id="deployment">Deployment</h1>
<h2 id="github-actions">GitHub Actions</h2>
<p>For easy deployment I use a GitHub Actions script that executes as soon as I push to the repository. The script is located in <em>.github/workflows/ci.yml</em>.</p>
<p>Just as the whole project, this script is heavily inspired by <em>Wolfgang&rsquo;s Channel</em>. His video can be found <a href="https://www.youtube.com/watch?v=ATenAnk8eX4">here</a>.</p>
<p>Because the Action has to run the Hugo build command and push the generated static files to the RaspberryPi, I let it run in an ubuntu environment called deploy which I created for the GitHub Repo. The Environment also contains the SSH credentials als secrets, but more on that later.</p>
<pre><code>name: CI
run-name: Hugo blog deployment
on:
    push:

jobs:
build:
    runs-on: ubuntu-latest
    environment: deploy
</code></pre>
<p>The script then goes through a few steps.<br>
Step 1: checking the current branch</p>
<pre><code>steps:
    - name: Checkout the current branch
      uses: actions/checkout@v3
</code></pre>
<p>Step 2: Initialising the ssh-agent in order to then later connect to the RaspberryPi.</p>
<pre><code>- name: Initialize the ssh-agent
  uses: webfactory/ssh-agent@v0.4.1
  with:
  ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}
</code></pre>
<p>Step 3: Installing my static website generator of choice - Hugo</p>
<pre><code>- name: Install Hugo
  run: sudo snap install hugo --edge
</code></pre>
<p>Step 4: Building the website using the Hugo command</p>
<pre><code>- name: Build the website
  run: hugo
</code></pre>
<p>Step 5: Because the annoying message you get when connecting to an unknown SSH server, which is the case everytime you run this script, and this would break the script, I scan for the host key first.</p>
<pre><code>- name: Scan the host key
  run: mkdir -p ~/.ssh/ &amp;&amp; ssh-keyscan -H $DEPLOY_SERVER &gt;&gt; ~/.ssh/known_hosts
  env:
    DEPLOY_SERVER: ${{ secrets.DEPLOY_SERVER }}
</code></pre>
<p>Step 6: The static website files the Hugo command put into the <em>public/</em> folder are then uploaded to the nginx host directory on the Pi.</p>
<pre><code>- name: Deploy the website
  run: &gt;-
    rsync -avx --delete --exclude '.ssh' public/ $DEPLOY_USERNAME@$DEPLOY_SERVER:./
  env:
    DEPLOY_SERVER: ${{ secrets.DEPLOY_SERVER }}
    DEPLOY_USERNAME: ${{ secrets.DEPLOY_USERNAME }}
</code></pre>
<h2 id="environment-secrets">Environment secrets</h2>
<p>You may have already noticed that the GitHub Actions script logs into the Pi as a deploy user via SSH. As I obviously do not want the Actions script to just expose my SSH credentials, I set them up as Environment secrets.</p>
<p>The script contains the information like this:</p>
<pre><code>ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}
DEPLOY_SERVER: ${{ secrets.DEPLOY_SERVER }}
DEPLOY_USERNAME: ${{ secrets.DEPLOY_USERNAME }}
</code></pre>
<p>These variables are linked to the Environment secrets I set in the deploy environment that I added to my GitHub repository.</p>
<p><img src="/images/screenshots/2023-05-13-112843.png" alt="Screenshot of my Environment Secrets section"></p>
<p>This way none of the credentials are visible in logs, commits or other repositories.</p>

        </p>
        
    </div>

    <div class="prev-next">
        
    </div>
</div>

<aside class="post-toc">
    <nav id="toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#static-website-generation">Static Website Generation</a>
      <ul>
        <li><a href="#what-is-hugo">What is Hugo?</a></li>
        <li><a href="#my-configuration">My configuration</a></li>
      </ul>
    </li>
    <li><a href="#hosting">Hosting</a>
      <ul>
        <li><a href="#software">Software</a></li>
        <li><a href="#security">Security</a></li>
      </ul>
    </li>
    <li><a href="#deployment">Deployment</a>
      <ul>
        <li><a href="#github-actions">GitHub Actions</a></li>
        <li><a href="#environment-secrets">Environment secrets</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </nav>
</aside>



    

        </main><footer class="footer">
    
    

    <span>&copy; 2023 Philipp Bruhns</span>
    <span>
        <a href="/impressum">Imprint</a> - <a href="/privacy">Privacy</a>
    </span>
    <span>
        Made with &#10084;&#65039; using <a target="_blank" href="https://github.com/526avijitgupta/gokarna">Gokarna</a>
    </span>
</footer>
</body>
</html>
